<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invol√∫crate con tu comunidad</title>
  <style>
    body {margin:0;font-family:'Segoe UI', Tahoma, sans-serif;background:#121212;color:#e0e0e0;}
    header {background:#1e1e1e;padding:15px 10%;display:flex;justify-content:space-between;align-items:center;color:#4caf50;}
    a {color:inherit;text-decoration:none;}
    .container {display:flex;height:calc(100vh - 70px);}
    .list {width:40%;overflow-y:auto;padding:20px;background:#1a1a1a;}
    .list h1 {text-align:center;margin-bottom:20px;color:#4caf50;}
    .pill {background:#2a2a2a;border:1px solid #4caf50;border-radius:20px;padding:15px;margin-bottom:15px;cursor:pointer;transition:.3s;}
    .pill:hover {background:#4caf50;color:#fff;}
    .pill h3 {margin:0 0 5px;}
    .pill p {margin:0 0 5px;font-size:.9rem;color:#bbb;}
    .pill span {font-weight:bold;color:#ccc;}
    .pill a {display:block;font-size:.85rem;color:#9cf;margin-top:5px;}
    #map {flex:1;height:100%;}
  </style>
</head>
<body>
  <header>
    <div><a href="index.html">‚¨Ö Volver al inicio</a></div>
    <div>ANCY</div>
  </header>
  <div class="container">
    <div class="list">
      <h1>Invol√∫crate con tu comunidad</h1>
      <div id="placesList">Cargando instituciones...</div>
    </div>
    <div id="map"></div>
  </div>

  <script>
    let map, service, markers=[];

    function initMap() {
      const merida = {lat:20.967370, lng:-89.592586};
      map = new google.maps.Map(document.getElementById("map"), {
        center: merida,
        zoom: 13,
      });

      service = new google.maps.places.PlacesService(map);

      const request = {
        query: "casa hogar OR albergue OR DIF OR PRODENNAY en Yucat√°n",
        location: merida,
        radius: 30000
      };

      service.textSearch(request, callback);
    }

    function callback(results, status) {
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        const list = document.getElementById("placesList");
        list.innerHTML = "";
        results.forEach((place, index) => {
          createMarker(place, index);
          renderPill(place, index);
        });
      } else {
        document.getElementById("placesList").innerHTML = "No se encontraron instituciones.";
      }
    }

    function createMarker(place, index) {
      const marker = new google.maps.Marker({
        map,
        position: place.geometry.location,
        title: place.name
      });
      markers.push(marker);
    }

    function renderPill(place, index) {
      const list = document.getElementById("placesList");
      const div = document.createElement("div");
      div.className = "pill";
      div.onclick = () => {
        map.panTo(place.geometry.location);
        map.setZoom(15);
        markers[index].setAnimation(google.maps.Animation.BOUNCE);
        setTimeout(()=>markers[index].setAnimation(null),1400);
      };

      div.innerHTML = `
        <h3>${place.name}</h3>
        <p>${place.formatted_address || "Sin direcci√≥n disponible"}</p>
        <span>üìû Buscando...</span>
      `;
      list.appendChild(div);

      service.getDetails({placeId: place.place_id, fields:["formatted_phone_number","website"]}, details=>{
        if(details){
          if(details.formatted_phone_number){
            div.querySelector("span").textContent = "üìû " + details.formatted_phone_number;
          } else {
            div.querySelector("span").textContent = "üìû No disponible";
          }
          if(details.website){
            const link = document.createElement("a");
            link.href = details.website;
            link.target="_blank";
            link.textContent = "üåê Sitio / Redes";
            div.appendChild(link);
          }
        }
      });
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1wZy8Nsu-ciITuSn1IahgCzWB4-NXpo0&libraries=places&callback=initMap"></script>
</body>
</html>